//
//  MarketData.swift
//  DataCrypto
//
//  Created by Juan Hernandez Pazos on 19/02/24.
//

import Foundation

// https://api.coingecko.com/api/v3/global

struct GlobalData: Codable {
    let data: MarketData?
}

struct MarketData: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "mxn" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "mxn" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
}

// JSON Data
/*
 JSON Response
 
 {
   "data": {
     "active_cryptocurrencies": 12780,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 942,
     "total_market_cap": {
       "btc": 39809235.65250136,
       "eth": 716355269.2748326,
       "ltc": 29448778354.32975,
       "bch": 7739667905.553167,
       "bnb": 5899629712.380115,
       "eos": 2670760639745.7437,
       "xrp": 3728792109480.1885,
       "xlm": 17761958771392.22,
       "link": 104976770296.78548,
       "dot": 267094795390.83838,
       "yfi": 267273583.2349793,
       "usd": 2084473339574.924,
       "aed": 7656041284191.349,
       "ars": 1740607425941285.8,
       "aud": 3188412504687.1445,
       "bdt": 228752547287706.12,
       "bhd": 785750563246.1249,
       "bmd": 2084473339574.924,
       "brl": 10332523812465.588,
       "cad": 2808531829862.9907,
       "chf": 1835526773102.8308,
       "clp": 2027150322736614.5,
       "cny": 15004872887596.15,
       "czk": 49237344754099.49,
       "dkk": 14418841968434.723,
       "eur": 1934178642844.8928,
       "gbp": 1652864374355.8813,
       "gel": 5492587249779.944,
       "hkd": 16303604001818.299,
       "huf": 751005925857722.8,
       "idr": 32621440493688470,
       "ils": 7549649764939.432,
       "inr": 173061650145076.25,
       "jpy": 312606903381046.8,
       "krw": 2782742556863429.5,
       "kwd": 641848946248.5702,
       "lkr": 651529179987830.4,
       "mmk": 4376531824906734.5,
       "mxn": 35541208452755.29,
       "myr": 9974204929866.035,
       "ngn": 3164128377774258,
       "nok": 21872618466593.734,
       "nzd": 3396013542468.7715,
       "php": 116774280956326.89,
       "pkr": 576990222687491.6,
       "pln": 8373821340780.633,
       "rub": 192650031854070.12,
       "sar": 7817487913288.111,
       "sek": 21730207248033.99,
       "sgd": 2805232108566.4434,
       "thb": 75099405478205.5,
       "try": 64346441308674.35,
       "twd": 65497637568867.734,
       "uah": 79820962715463.2,
       "vef": 208718315491.63724,
       "vnd": 51146451280743850,
       "zar": 39473254736862.445,
       "xdr": 1573095748597.0269,
       "xag": 90426808925.63382,
       "xau": 1033002452.8931459,
       "bits": 39809235652501.36,
       "sats": 3980923565250136
     },
     "total_volume": {
       "btc": 1339321.7108896377,
       "eth": 24100692.94534901,
       "ltc": 990759746.1407778,
       "bch": 260389457.14678043,
       "bnb": 198484146.46724814,
       "eos": 89853714867.19856,
       "xrp": 125449588412.45657,
       "xlm": 597574322152.4899,
       "link": 3531785157.214516,
       "dot": 8986001676.977642,
       "yfi": 8992016.724425208,
       "usd": 70128962631.51202,
       "aed": 257575965559.6544,
       "ars": 58560112433417.48,
       "aud": 107269331370.12346,
       "bdt": 7696034550326.333,
       "bhd": 26435392979.79895,
       "bmd": 70128962631.51202,
       "brl": 347622184739.17883,
       "cad": 94488818833.26878,
       "chf": 61753530753.39319,
       "clp": 68200416159145.48,
       "cny": 504816324606.67676,
       "czk": 1656516226318.9524,
       "dkk": 485100197923.491,
       "eur": 65072524167.854744,
       "gbp": 55608129757.99383,
       "gel": 184789816534.03485,
       "hkd": 548510174774.24005,
       "huf": 25266462041323.344,
       "idr": 1097499180217144.1,
       "ils": 253996583306.94156,
       "inr": 5822398284281.641,
       "jpy": 10517187929125.89,
       "krw": 93621177627145.75,
       "kwd": 21594040044.532524,
       "lkr": 21919716913253.383,
       "mmk": 147241814504135.84,
       "mxn": 1195730370900.4648,
       "myr": 335567086191.7858,
       "ngn": 106452328534692.61,
       "nok": 735871269723.1584,
       "nzd": 114253755274.44633,
       "php": 3928694615579.9375,
       "pkr": 19411966081490.14,
       "pln": 281724593325.96564,
       "rub": 6481419852368.455,
       "sar": 263007593973.39047,
       "sek": 731080058996.1741,
       "sgd": 94377804685.4231,
       "thb": 2526606265688.12,
       "try": 2164838999057.2036,
       "twd": 2203569261507.6226,
       "uah": 2685455939976.4526,
       "vef": 7022013028.293303,
       "vnd": 1720745236939889.5,
       "zar": 1328018139560.4177,
       "xdr": 52924434616.01108,
       "xag": 3042273644.6827617,
       "xau": 34753810.01129844,
       "bits": 1339321710889.6377,
       "sats": 133932171088963.77
     },
     "market_cap_percentage": {
       "btc": 49.31526737003916,
       "eth": 16.77600591945619,
       "usdt": 4.690310023576823,
       "bnb": 2.608185787241168,
       "sol": 2.378137383515117,
       "xrp": 1.4628097133724838,
       "steth": 1.3654803662199082,
       "usdc": 1.3460601215533874,
       "ada": 1.0589759744634173,
       "avax": 0.7071415753675855
     },
     "market_cap_change_percentage_24h_usd": 1.7963451207923766,
     "updated_at": 1708346275
   }
 }
 */
